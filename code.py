import streamlit as st
import yfinance as yf
import numpy as np
from PIL import Image
import plotly.graph_objects as go
import base64

from streamlit.components.v1 import html

# Configuration de la page
st.set_page_config(
    page_title="FinFlation - Simulation d'investissement",
    page_icon="üí∞",
    layout="wide",
    initial_sidebar_state="collapsed"  # ‚Üê √ßa va la masquer au d√©marrage
)


# Style CSS personnalis√©
st.markdown("""
    <style>
    /* Suppression de la barre blanche par d√©faut */
    header {
        background-color: #1a237e !important;
        border-bottom: none !important;
    }
    
    /* Style principal bleu fonc√© */
    .main {
        background-color: #1a237e;
    }
    
    /* Tous les textes en blanc */
    h1, h2, h3, h4, h5, h6, p, div, span, label {
        color: white !important;
    }
    
    /* Sidebar bleu plus clair */
    [data-testid=stSidebar] {
        background-color: #3949ab !important;
    }
    
    /* En-t√™te personnalis√© */
    .custom-header {
        background-color: #1a237e;
        padding: 1rem 0;
        margin: -1rem 0 1rem 0;
        display: flex;
        align-items: center;
        justify-content: center;
        border-bottom: 2px solid #4CAF50;
    }
    
    /* Logo et titre */
    .logo-title {
        display: flex;
        align-items: center;
        gap: 1.5rem;
    }
    
    /* Boutons */
    .stButton>button {
        background-color: #4CAF50;
        color: white;
        border-radius: 20px;
        padding: 10px 24px;
        font-weight: bold;
    }
    
    /* Slider */
    .stSlider>div>div>div>div {
        background-color: #4CAF50;
    }
    
    /* Tableaux */
    table {
        color: white !important;
    }
    
    /* Bo√Ætes de r√©sultats */
    .result-box {
        background-color: #283593;
        padding: 20px;
        border-radius: 15px;
        margin: 15px 0;
        box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2);
        border-left: 5px solid #4CAF50;
    }
    
    /* Correction des titres des graphiques Plotly */
    .gtitle {
        color: white !important;
        font-size: 16px !important;
    }
    
    /* Style du disclaimer */
    .disclaimer-box {
        background-color: #d32f2f;
        padding: 15px;
        border-radius: 10px;
        margin-bottom: 20px;
        font-size: 14px;
    }
    /* Centrer le titre Menu dans la sidebar */
    [data-testid="stSidebar"] h1 {
        text-align: center !important;
    }
    /* Centrer le titre Menu dans la sidebar */
    [data-testid="stSidebar"] h1 {
        text-align: center !important;
        padding-bottom: 10px;
        margin-bottom: 20px;
    }
    
    /* Bo√Ætes de r√©sultats */
    .result-box {
        background-color: #283593;
        padding: 20px;
        border-radius: 15px;
        margin: 15px 0;
        box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2);
        border-left: 5px solid #4CAF50;
    }

    /* Bo√Æte pour les r√©sultats financiers */
    .financial-box {
        background-color: #283593;
        padding: 20px;
        border-radius: 15px;
        margin: 15px 0;
        box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2);
        border-left: 5px solid #4CAF50;
        font-size: 18px;
        color: white;
    }
    /* Bo√Æte pour les taux */
    .rate-box {
        background-color: #283593;
        padding: 20px;
        border-radius: 15px;
        margin: 15px 0;
        box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2);
        border-left: 5px solid #4CAF50;
        font-size: 18px;
        color: white;
    }

    </style>
    """, unsafe_allow_html=True)



# En-t√™te personnalis√© avec logo
st.markdown(f"""
    <div class="custom-header">
        <div class="logo-title">
            <img src="data:image/png;base64,{base64.b64encode(open('logo.png', 'rb').read()).decode()}" 
                 alt="Logo FinFlation" width="80">
            <div>
                <h1 style="margin:0; font-size:2.5rem;">FinFlation</h1>
                <p style="margin:0; font-size:1.2rem;">Optimisez vos investissements face √† l'inflation</p>
            </div>
        </div>
    </div>
    """, unsafe_allow_html=True)

# Initialisation du state
if "page" not in st.session_state:
    st.session_state.page = "Accueil"


with st.sidebar:
    st.markdown("""
        <div style="display: flex; align-items: center; justify-content: center; margin-bottom: 10px;">
            <h1 style="margin: 0; color: white;">Menu</h1>
            <img src="data:image/png;base64,{}" alt="Logo" width="40" style="margin-left: 10px;"/>
        </div>
        <hr style="border-top: 2px solid white; margin-top: 5px; margin-bottom: 20px;">
    """.format(base64.b64encode(open("logo.png", "rb").read()).decode()), unsafe_allow_html=True)

    # RADIO + changement de page sans double clic
    new_page = st.radio(
        "Navigation",
        ["Accueil", "Pr√©sentation", "Vocabulaire financier", "Comprendre les placements", "Testez vos connaissances fianci√®res", "Simulateur d'investissement"],
        index=["Accueil", "Pr√©sentation", "Vocabulaire financier", "Comprendre les placements", "Testez vos connaissances fianci√®res", "Simulateur d'investissement"].index(st.session_state.page)
    )

    if new_page != st.session_state.page:
        st.session_state.page = new_page
        st.experimental_rerun()


page = st.session_state.page




if page == "Accueil":
    st.markdown("""
        <style>
        /* Style g√©n√©ral boutons */
        div.stButton > button {
            background-color: #42a5f5;
            color: white;
            border: none;
            border-radius: 25px;
            padding: 0.8em 1.5em;
            font-size: 18px;
            font-weight: bold;
            transition: 0.3s;
            width: 280px;
        }
        div.stButton > button:hover {
            background-color: #1e88e5;
            transform: scale(1.05);
        }
    
        /* Conteneur central */
        .centered-buttons {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2rem;
            max-width: 900px;
            margin: auto;
            padding-top: 30px;
        }
        
        /* Style rouge uniquement pour le bouton "simulateur_btn" */
        div[data-testid="stButton"][data-button-key="simulateur_btn"] > button {
            background-color: #e53935 !important;
        }
        div[data-testid="stButton"][data-button-key="simulateur_btn"] > button:hover {
            background-color: #c62828 !important;
        }
        </style>
    """, unsafe_allow_html=True)


    # Titre centr√©
    st.markdown("<h1 style='text-align: center; color: white;'>Bienvenue sur FinFlation</h1>", unsafe_allow_html=True)

    # Texte d‚Äôintroduction centr√©
    

    # Disclaimer
    st.markdown("""
    <div class="disclaimer-box">
        ‚ö† <strong>Disclaimer :</strong> Notre simulation est fournie √† titre informatif uniquement et ne constitue pas 
        un conseil en investissement. Les r√©sultats sont bas√©s sur des hypoth√®ses et des donn√©es historiques qui ne 
        garantissent pas les performances futures. Consultez un conseiller financier avant toute d√©cision d'investissement.
    </div>
    """, unsafe_allow_html=True)
    
    # Fonction pour convertir une image en base64
    def img_to_base64(path):
        with open(path, "rb") as f:
            return base64.b64encode(f.read()).decode()
    
    # Charger les images
    img1 = img_to_base64("livret.png")
    img2 = img_to_base64("capbourse.png")
    img3 = img_to_base64("fin.png")
    img4 = img_to_base64("graphe.png")
    img5 = img_to_base64("etf.png")
    
    # Deux colonnes : texte √† gauche, carrousel √† droite
    col1, col2 = st.columns([1, 1])
    
    with col1:
        st.markdown("""
        <div style="background-color: #283593; padding: 27px; border-radius: 15px; color: white; width: 90%;">
            <h2 style="color: #4CAF50;">Contexte √©conomique</h2>
            <p style="font-size: 18px;">
                En France, l‚Äôinflation a fortement augment√© depuis 2021, port√©e par la hausse des prix de l‚Äô√©nergie, de l‚Äôalimentation et des mati√®res premi√®res.  
                Apr√®s un pic √† plus de 6 % en 2022, elle reste √©lev√©e, r√©duisant le pouvoir d‚Äôachat des m√©nages et pesant sur leur capacit√© √† √©pargner.
            </p>
        </div>
        """, unsafe_allow_html=True)


    
    with col2:
        html(f"""
        <div style="width: 100%; height: 300px; overflow: hidden; border-radius: 20px;">
            <img id="carousel" 
                 src="data:image/png;base64,{img1}" 
                 style="width: 100%; height: 100%; object-fit: contain; transition: opacity 1s;">
        </div>
    
        <script>
        const images = [
            "data:image/png;base64,{img1}",
            "data:image/png;base64,{img2}",
            "data:image/png;base64,{img3}",
            "data:image/png;base64,{img4}",
            "data:image/png;base64,{img5}"
        ];

        let index = 0;
        setInterval(() => {{
            const carousel = document.getElementById("carousel");
            carousel.style.opacity = 0;
            setTimeout(() => {{
                index = (index + 1) % images.length;
                carousel.src = images[index];
                carousel.style.opacity = 1;
            }}, 500);
        }}, 3000);
        </script>
        """, height=320)
        
    st.markdown("""
    <hr style="height: 3px; background-color: #4CAF50; border: none; margin-top: 30px; margin-bottom: 30px;">
    """, unsafe_allow_html=True)
    
    st.markdown("""
    <p style="text-align: center; font-size:18px; color: white;">
        Explorez les rubriques pour d√©couvrir les bases de la finance, comprendre les principaux placements, 
        enrichir votre vocabulaire et mettre vos connaissances √† l‚Äô√©preuve gr√¢ce √† un quiz interactif.
    </p>
    """, unsafe_allow_html=True)


    
    # Conteneur des boutons centr√©s
    st.markdown('<div class="centered-buttons">', unsafe_allow_html=True)

    # Espacement
    st.markdown("<br>", unsafe_allow_html=True)
    
    # LIGNE 1 : Pr√©sentation (gauche) & Vocabulaire (droite)
    col1, col2, col3, col4, col5 = st.columns([2, 3, 1, 3, 2])
    with col2:
        if st.button("üìò Pr√©sentation"):
            st.session_state.page = "Pr√©sentation"
            st.experimental_rerun()
    with col4:
        if st.button("üìö Vocabulaire financier"):
            st.session_state.page = "Vocabulaire financier"
            st.experimental_rerun()
    
    # Espacement
    st.markdown("<br>", unsafe_allow_html=True)
    
    # LIGNE 2 : Comprendre (gauche) & Simulateur (droite)
    col6, col7, col8, col9, col10 = st.columns([2, 3, 1, 3, 2])
    with col7:
        if st.button("üìà Comprendre les placements"):
            st.session_state.page = "Comprendre les placements"
            st.experimental_rerun()
    with col9:
        if st.button("üß† Testez vos connaissances fianci√®res"):
            st.session_state.page = "Testez vos connaissances fianci√®res"
            st.experimental_rerun()

    st.markdown("""
    <hr style="height: 3px; background-color: #4CAF50; border: none; margin-top: 30px; margin-bottom: 30px;">
    """, unsafe_allow_html=True)

    st.markdown('</div>', unsafe_allow_html=True)
    
    st.markdown("""
    <p style="font-size: 18px; color: white; text-align: center;">
        Explorer notre simulateur qui vous permet de comparer l‚Äô√©volution potentielle d‚Äôun placement en ETF face au Livret A, 
        en tenant compte de la dur√©e de l‚Äôinvestissement, du montant investi et de l'inflation actuelle. 
        
        
    </p>
    """, unsafe_allow_html=True)
    st.markdown("""
    <p style="font-size: 18px; color: white; text-align: center;">
        Visualisez en un clic l‚Äôimpact de vos choix d‚Äôallocation.
    </p>
    """, unsafe_allow_html=True)
    st.markdown("""
    <p style="font-size: 18px; color: white; text-align: center;">
     </p>
    """, unsafe_allow_html=True)
    
    
    # Cr√©e 7 colonnes pour un centrage tr√®s pr√©cis
    col1, col2, col3, col4, col5, col6, col7 = st.columns([1, 1, 1, 2, 1, 1, 1])  # col4 est la plus large et au centre
    
    with col4:
        if st.button("üìà Simuler votre capital", key="simulateur_btn"):
            st.session_state.page = "Simulateur d'investissement"
            st.experimental_rerun()
    
    
    
elif page == "Pr√©sentation":

    st.markdown("""
    <div style="background-color: #283593; padding: 30px; border-radius: 15px; color: white;">
        <h2 style="color: #4CAF50;">üîç C‚Äôest quoi FinFlation ?</h2>
        <p style="font-size: 18px;">
            FinFlation est une plateforme √©ducative et interactive qui aide chacun √† <strong>mieux comprendre les placements financiers</strong>, 
            sp√©cialement dans un contexte d‚Äôinflation.  
            L‚Äôobjectif est simple : rendre la finance <strong>accessible, claire et utile</strong> pour toutes les g√©n√©rations, que vous soyez d√©butant ou curieux d‚Äôen savoir plus.
        </p>

    <h2 style="color: #4CAF50;">üìå Que propose FinFlation ?</h2>
        <ul style="font-size: 17px;">
            <li><strong>Un simulateur</strong> pour tester diff√©rents sc√©narios d'investissement entre ETF et Livret A.</li>
            <li><strong>Un vocabulaire clair</strong> pour mieux comprendre les mots compliqu√©s de la finance.</li>
            <li><strong>Des fiches explicatives</strong> sur les placements comme les ETF ou les livrets d‚Äô√©pargne.</li>
        </ul>

    <h2 style="color: #4CAF50;">üß† Pourquoi c‚Äôest important ?</h2>
        <p style="font-size: 18px;">
            Dans un monde o√π <strong>l‚Äôinflation impacte le pouvoir d‚Äôachat</strong>, il est essentiel de savoir o√π et comment investir intelligemment.  
            FinFlation vous donne les cl√©s pour prendre vos d√©cisions en toute connaissance de cause, sans jargon ni complexit√©.
        </p>

    <h2 style="color: #4CAF50;">üöÄ Pr√™t √† commencer ?</h2>
        <p style="font-size: 18px;">
            Explorez le menu √† gauche pour tester le simulateur, enrichir votre vocabulaire ou d√©couvrir les bases de l‚Äôinvestissement.
        </p>
    </div>
    """, unsafe_allow_html=True)
    
    
    # Style du bouton bleu
    st.markdown("""
        <style>
        div.stButton > button {
            background-color: #42a5f5;
            color: white;
            border: none;
            border-radius: 25px;
            padding: 0.8em 1.5em;
            font-size: 18px;
            font-weight: bold;
            transition: 0.3s;
        }
        div.stButton > button:hover {
            background-color: #1e88e5;
            transform: scale(1.05);
        }
        </style>
    """, unsafe_allow_html=True)
    
    # Colonne principale √† gauche + vide √† droite
    col1, col2 = st.columns([1, 3])  # bouton √† gauche
    with col1:
        if st.button("Retourner √† l'accueil"):
            st.session_state.page = "Accueil"
            st.experimental_rerun()
    
    
    
    
    
    
    
elif page == "Vocabulaire financier":

    st.header("üìö Vocabulaire financier")
    
    st.markdown("""
    <div style="background-color: #283593; padding: 25px; border-radius: 15px; color: white; margin-bottom: 20px;">
        <p style="font-size: 18px;">
            Comprendre les <span style="font-weight: 900;">mots de la finance</span> est une premi√®re √©tape essentielle pour prendre des 
            <span style="font-weight: 900;">d√©cisions √©clair√©es</span>.  
            Que vous soyez <span style="font-weight: 900;">d√©butant</span> ou que vous souhaitiez rafra√Æchir vos connaissances, cette section vous permet de d√©couvrir les 
            <span style="font-weight: 900;">notions cl√©s</span> comme la <span style="font-weight: 900;">volatilit√©</span>, la 
            <span style="font-weight: 900;">liquidit√©</span> ou encore les <span style="font-weight: 900;">actions</span>. 
        </p>
        <p style="font-size: 18px;">
            Chaque terme est expliqu√© simplement, avec des <span style="font-weight: 900;">analogies du quotidien</span>, pour rendre la finance plus 
            <span style="font-weight: 900;">accessible</span> et moins <span style="font-weight: 900;">intimidante</span>.
        </p>
    </div>
    """, unsafe_allow_html=True)



    with st.expander("üí∏ Qu'est-ce que la volatilit√© ?", expanded=False):
        st.markdown("""
        **La volatilit√©**, c‚Äôest une mesure des variations d‚Äôun prix dans le temps. 
        
        Plus un actif est volatil, plus son prix monte ou descend rapidement.  
        C‚Äôest un peu comme une mer agit√©e : plus elle est instable, plus c‚Äôest risqu√©. 
        
        Mais une forte volatilit√© peut aussi vouloir dire plus de potentiel de gain.
        """, unsafe_allow_html=True)

        st.image("volatilite.png", caption="Illustration de la volatilite", width=700)
        
        st.markdown("""
        **üß≠ Comment lire ce sch√©ma ?**
        
        Sur **la gauche**, la courbe bouge doucement : c‚Äôest une **volatilit√© faible**.  
        Les variations de prix sont petites, donc le risque est plus faible.
        
        Sur **la droite**, la courbe monte et descend rapidement et fortement : c‚Äôest une **volatilit√© √©lev√©e**.  
        Les variations de prix sont grandes, donc le risque est plus √©lev√©.
        
        üëâ En r√©sum√© : **plus la courbe est agit√©e, plus la volatilit√© est forte**.
        """)



        
    with st.expander("üè¶ Qu'est-ce que la liquidit√© ?", expanded=False):
        st.markdown("""
        **La liquidit√©**, c‚Äôest la facilit√© avec laquelle on peut acheter ou vendre un produit financier.  
        
        Par exemple, un livret A est tr√®s liquide car on peut retirer l‚Äôargent √† tout moment.  
        Une maison est peu liquide car cela prend du temps pour la vendre.  
        
        En finance, plus c‚Äôest liquide, plus c‚Äôest simple d‚Äôacheter ou de revendre rapidement.
        """)

    with st.expander("üìà Qu'est-ce qu'un indice boursier ?", expanded=False):
        st.markdown("""
        **Un indice boursier**, c‚Äôest un chiffre qui refl√®te l‚Äô√©volution d‚Äôun groupe d‚Äôentreprises en Bourse.  
        
        Par exemple, le CAC 40 regroupe les 40 plus grandes entreprises fran√ßaises.  
        Si l‚Äôindice monte, cela veut dire que globalement ces entreprises vont bien.  
        
        C‚Äôest un bon moyen de suivre la sant√© d‚Äôun march√© sans regarder chaque entreprise individuellement.
        """)
        
        st.image("indices.jpg", caption="Evolution des grands indices boursiers", width=400)

        st.markdown("""
        **üìä Voici une liste des principaux indices boursiers mondiaux :**
        
        Ce sch√©ma pr√©sente les performances de diff√©rents indices sur une p√©riode de 25 ans :
        
        - **Nasdaq (üá∫üá∏)** : Regroupe principalement les grandes entreprises technologiques am√©ricaines (Apple, Amazon, Microsoft...).
        - **Dow Jones (üá∫üá∏)** : Compos√© de 30 grandes entreprises am√©ricaines traditionnelles (comme Coca-Cola ou McDonald‚Äôs).
        - **S&P 500 (üá∫üá∏)** : Repr√©sente les 500 plus grandes entreprises cot√©es aux √âtats-Unis.
        - **Toronto Stock Exchange (üá®üá¶)** : Principal indice du march√© canadien.
        - **Shanghai Composite (üá®üá≥)** : Indice regroupant les entreprises cot√©es √† la Bourse de Shanghai.
        - **CAC 40 (üá´üá∑)** : Indice phare de la Bourse de Paris, avec 40 grandes entreprises fran√ßaises.
        - **Eurostoxx 50 (üá™üá∫)** : Repr√©sente les 50 plus grandes entreprises de la zone euro.
        - **Nikkei 225 (üáØüáµ)** : Principale r√©f√©rence de la Bourse de Tokyo, avec les grandes entreprises japonaises.
        
        üëâ En r√©sum√© : ces indices permettent de suivre l‚Äô√©volution des march√©s dans chaque r√©gion. Le **Nasdaq** domine largement en termes de performance sur cette p√©riode, tir√© par la croissance du secteur technologique.
        """)



    with st.expander("üíº Qu'est-ce qu'un fonds d'investissement ?", expanded=False):
        st.markdown("""
        **Un fonds d‚Äôinvestissement**, c‚Äôest un ‚Äúpanier‚Äù d‚Äôactifs (actions, obligations, etc.) g√©r√© par des professionnels.  
        
        Quand tu investis dans un fonds, ton argent est m√©lang√© avec celui d‚Äôautres investisseurs, puis investi selon une strat√©gie.  
        L‚Äôid√©e est de diversifier les placements et de confier la gestion √† des experts.  
        
        Les ETF sont un type de fonds, mais ils sont cot√©s en Bourse.
        """)

    with st.expander("üè¢ Qu'est-ce que la capitalisation boursi√®re ?", expanded=False):
        st.markdown("""
        **La capitalisation boursi√®re**, c‚Äôest la valeur totale d‚Äôune entreprise en Bourse.  
        
        On la calcule en multipliant le prix d‚Äôune action par le nombre total d‚Äôactions.  
        Par exemple, si une action vaut 100‚Ç¨ et qu‚Äôil y a 1 million d‚Äôactions, la capitalisation est de 100 millions d‚Äôeuros.  
        
        C‚Äôest un bon indicateur de la taille d‚Äôune entreprise cot√©e.
        """)
        
        st.image("capbourse.png", caption="Illustration de la capitalisation boursi√®re", width=400)

    with st.expander("üí° Qu'est-ce que le rendement ?", expanded=False):
            st.markdown("""
            Le **rendement** est le **gain financier** que vous obtenez en investissant de l‚Äôargent, g√©n√©ralement exprim√© en **pourcentage du capital investi**.
        
            Par exemple, si vous placez **1 000 ‚Ç¨** et que vous gagnez **50 ‚Ç¨** au bout d‚Äôun an, le rendement est de **5 %**.
        
            Il existe deux types de rendement :
            - Le **rendement courant** : ce que vous touchez chaque ann√©e (ex : int√©r√™ts, dividendes).
            - Le **rendement global** : inclut aussi les √©ventuelles plus-values (hausse de valeur de l‚Äôactif).
        
            üëâ **Plus le rendement est √©lev√©**, plus le placement est **potentiellement rentable**‚Ä¶ mais cela va souvent **de pair avec un risque plus important**.
            """)
        
    with st.expander("üìâ Qu'est-ce que le risque de perte en capital ?", expanded=False):
            st.markdown("""
            Le **risque de perte en capital**, c‚Äôest la **possibilit√© que vous ne r√©cup√©riez pas tout l‚Äôargent que vous avez investi**.
        
            C‚Äôest un risque pr√©sent dans des produits comme :
            - Les **actions**
            - Les **ETF**
            - Les **obligations d‚Äôentreprise**
            - Les **SCPI**
            - Les **cryptomonnaies**
        
            Contrairement aux **livrets r√©glement√©s** (comme le Livret A), o√π le capital est **garanti par l‚Äô√âtat**, ces placements peuvent **baisser en valeur**.
        
            üëâ En r√©sum√© : vous pouvez **perdre de l‚Äôargent**, notamment en cas de crise √©conomique ou de mauvaise gestion.
            """)
    with st.expander("üéØ Qu'est-ce que la diversification ?", expanded=False):
            st.markdown("""
            La **diversification** est une **strat√©gie de gestion du risque** qui consiste √† **r√©partir vos investissements sur diff√©rents types de placements**.
        
            L‚Äôid√©e est simple :
            - Si un placement chute, les autres peuvent compenser.
            - Vous n‚Äô√™tes pas d√©pendant d‚Äôun seul actif ou secteur.
        
            Exemple : au lieu d‚Äôinvestir 10 000 ‚Ç¨ uniquement en actions, vous pouvez r√©partir :
            - 4 000 ‚Ç¨ en ETF
            - 3 000 ‚Ç¨ en Livret A
            - 2 000 ‚Ç¨ en SCPI
            - 1 000 ‚Ç¨ en obligations
        
            üëâ En diversifiant, vous **limitez les pertes potentielles** et **√©quilibrez les performances** de votre portefeuille.
            """)
        
    with st.expander("üí∏ Qu'est-ce qu‚Äôun dividende ?", expanded=False):
            st.markdown("""
            Un **dividende** est une **part des b√©n√©fices** qu'une entreprise verse √† ses **actionnaires**.  
            C‚Äôest une **r√©compense** pour avoir investi dans l‚Äôentreprise.
        
            Vous pouvez recevoir des dividendes si vous d√©tenez :
            - Des **actions**
            - Certains **ETF** qui distribuent les revenus
        
            Tous les titres ne versent pas de dividendes.  
            Certaines entreprises pr√©f√®rent **r√©investir leurs b√©n√©fices** pour se d√©velopper plut√¥t que les distribuer.
        
            üëâ Le dividende est une **source de revenu passif**, souvent vers√©e **chaque trimestre ou une fois par an**.
            """)
            
    with st.expander("üìä Qu‚Äôest-ce que le taux d‚Äôint√©r√™t ?", expanded=False):
        st.markdown("""
        Le **taux d‚Äôint√©r√™t**, c‚Äôest le **co√ªt de l‚Äôargent emprunt√©** ou le **rendement d‚Äôun placement**.  
        C‚Äôest un pourcentage qui indique combien vous gagnez (ou payez) **chaque ann√©e** sur un montant donn√©.
    
        Deux cas :
        - Si vous **empruntez** (pr√™t immobilier, cr√©dit √† la consommation‚Ä¶) ‚Üí vous **payez** un taux d‚Äôint√©r√™t √† la banque.
        - Si vous **placez** de l‚Äôargent (livret, obligation‚Ä¶) ‚Üí vous **touchez** un taux d‚Äôint√©r√™t.
    
        **Exemple simple :**  
        Si vous placez 1 000 ‚Ç¨ √† un taux de 3 % pendant 1 an, vous gagnez 30 ‚Ç¨ d‚Äôint√©r√™ts.
    
        üëâ Le taux d‚Äôint√©r√™t peut √™tre **fixe** (ne bouge pas) ou **variable** (change avec le temps).
        """)
        
    with st.expander("üåê Qu‚Äôest-ce que d√©centralis√© veut dire ?", expanded=False):
        st.markdown("""
        En finance, **d√©centralis√©** veut dire **qu‚Äôil n‚Äôy a pas d‚Äôautorit√© centrale** (comme une banque, un gouvernement ou une entreprise) qui contr√¥le le syst√®me.
    
        Dans le cas des **cryptomonnaies** :
        - Pas de banque centrale.
        - Les transactions sont v√©rifi√©es par un **r√©seau d‚Äôutilisateurs**, gr√¢ce √† la technologie **blockchain**.
        - Les donn√©es sont **r√©parties** (copies sur de nombreux ordinateurs) ‚Üí c‚Äôest ce qu‚Äôon appelle un **r√©seau d√©centralis√©**.
    
        üëâ Cela rend le syst√®me plus **transparent**, plus **r√©silient**‚Ä¶ mais parfois **plus risqu√©** ou moins r√©glement√©.
        """)
    
    with st.expander("‚ö†Ô∏è Quels sont les diff√©rents types de risques ?", expanded=False):
        st.markdown("""
        En finance, tout investissement comporte des **risques**. Voici les principaux √† conna√Ætre :
    
        - **Risque de march√©** : vos actifs peuvent **perdre de la valeur** √† cause des variations des march√©s (ex : chute de la Bourse).
        - **Risque de taux** : si les **taux d‚Äôint√©r√™t augmentent**, la valeur des obligations baisse.
        - **Risque de liquidit√©** : vous pouvez avoir **du mal √† vendre** rapidement un actif sans perte (ex : immobilier, SCPI).
        - **Risque de cr√©dit** : l‚Äô√©metteur (entreprise, √âtat...) **ne rembourse pas** (ex : d√©faut d‚Äôune obligation).
        - **Risque de change** : si vous investissez dans une **devise √©trang√®re**, son √©volution peut impacter vos gains.
        - **Risque r√©glementaire** : changement de loi ou de fiscalit√© qui affecte votre investissement (ex : taxation des crypto-actifs).
    
        üëâ La **diversification** permet de limiter certains de ces risques.
        """)

    # Style du bouton bleu
    st.markdown("""
        <style>
        div.stButton > button {
            background-color: #42a5f5;
            color: white;
            border: none;
            border-radius: 25px;
            padding: 0.8em 1.5em;
            font-size: 18px;
            font-weight: bold;
            transition: 0.3s;
        }
        div.stButton > button:hover {
            background-color: #1e88e5;
            transform: scale(1.05);
        }
        </style>
    """, unsafe_allow_html=True)
    
    # Colonne principale √† gauche + vide √† droite
    col1, col2 = st.columns([1, 3])  # bouton √† gauche
    with col1:
        if st.button("Retourner √† l'accueil"):
            st.session_state.page = "Accueil"
            st.experimental_rerun()








    
    
    
if page == "Comprendre les placements":

    # Page "Comprendre les placements"
    st.header("üìö Comprendre les placements")
    
    st.markdown("""
    <div style="background-color: #283593; padding: 25px; border-radius: 15px; color: white; margin-bottom: 20px;">
        <p style="font-size: 18px;">
            Comprendre les <span style="font-weight: 900;">diff√©rents types de placements</span> est essentiel pour b√¢tir une strat√©gie d‚Äô√©pargne efficace.  
            Que vous cherchiez √† <span style="font-weight: 900;">s√©curiser</span> votre capital ou √† <span style="font-weight: 900;">le faire fructifier</span>, cette section vous pr√©sente les principales solutions disponibles.
        </p>
        <p style="font-size: 18px;">
            Chaque produit d‚Äôinvestissement (actions, ETF, obligations, SCPI, cryptomonnaies...) est expliqu√© de fa√ßon claire et structur√©e, avec ses 
            <span style="font-weight: 900;">caract√©ristiques</span>, <span style="font-weight: 900;">avantages</span> et <span style="font-weight: 900;">inconv√©nients</span>.  
            L‚Äôobjectif est de vous permettre de mieux <span style="font-weight: 900;">comparer les options</span> et de <span style="font-weight: 900;">faire des choix adapt√©s</span> √† votre profil.
        </p>
    </div>
    """, unsafe_allow_html=True)


    with st.expander("üìä Qu'est-ce qu'une action ?", expanded=False):
        st.markdown("""
        *Une action repr√©sente une part du capital d'une entreprise cot√©e en bourse.*

        En achetant une action, vous devenez actionnaire et donc copropri√©taire de l‚Äôentreprise. Vous pouvez b√©n√©ficier de la croissance de l‚Äôentreprise via les dividendes et la valorisation du titre.

        *Caract√©ristiques :*
        - Droit de vote √† l'assembl√©e g√©n√©rale
        - √âligibilit√© √† des dividendes
        - Cours variable selon l‚Äôoffre et la demande
        - Cotation en bourse

        *Avantages :*
        - Potentiel de gain √©lev√© √† long terme
        - Participation aux b√©n√©fices de l‚Äôentreprise (dividendes)
        - Facilit√© d‚Äôachat/vente (liquidit√©)

        *Inconv√©nients :*
        - Risque de perte en capital
        - Volatilit√© importante
        - Pas de garantie de revenus r√©guliers
        """)

    with st.expander("üí∏ Qu'est-ce qu'un ETF ?", expanded=False):
        st.markdown("""
        *Un ETF (Exchange-Traded Fund) en bref*  
        Un ETF est un fonds d'investissement cot√© en bourse qui r√©plique la performance d'un indice boursier.

        *Caract√©ristiques principales :*
        - Diversification automatique
        - Faibles frais de gestion
        - Transparence sur la composition
        - Liquidit√© (achat/vente en temps r√©el)
        - Potentiel de rendement sup√©rieur √† long terme

        *Avantages face √† l'inflation :*
        - Les actions ont historiquement surperform√© l'inflation
        - Croissance des entreprises compense l'√©rosion mon√©taire
        - Dividendes augmentent souvent avec l'inflation

        *Risques :*
        - Volatilit√© √† court terme
        - Performance pass√©e ne garantit pas les r√©sultats futurs
        - N√©cessite un horizon d'investissement moyen/long terme
        """)

    with st.expander("üí∏ Qu'est-ce qu'une obligation ?", expanded=False):
        st.markdown("""
        *Une obligation, c‚Äôest un emprunt que vous faites √† une entreprise ou √† un √âtat.*  
        En achetant une obligation, vous pr√™tez votre argent, et en √©change vous recevez des int√©r√™ts pendant une dur√©e d√©finie.

        *Caract√©ristiques principales :*
        - Revenu fixe (les int√©r√™ts ou "coupons")
        - √âch√©ance connue √† l‚Äôavance
        - Moins risqu√© que les actions en g√©n√©ral
        - Peut √™tre revendu sur le march√© secondaire

        *Avantages :*
        - Revenus stables et pr√©visibles
        - Bonne visibilit√© sur l‚Äôinvestissement
        - Moins de volatilit√© que les actions

        *Risques :*
        - Risque de d√©faut (l‚Äô√©metteur peut ne pas rembourser)
        - Rendement parfois inf√©rieur √† l‚Äôinflation
        - Sensibilit√© aux taux d‚Äôint√©r√™t (si les taux montent, le prix des obligations baisse)
        """)

    with st.expander("üè¶ Qu'est-ce qu'un livret d'√©pargne ?", expanded=False):
        st.markdown("""
        *Un livret d‚Äô√©pargne est un compte bancaire qui permet de placer de l‚Äôargent tout en g√©n√©rant des int√©r√™ts.*  
        Il est s√©curis√© et souvent r√©glement√© par l‚Äô√âtat (comme le Livret A).

        *Caract√©ristiques :*
        - Taux fixe d√©fini par l‚Äô√âtat (ex : 2,4% pour le Livret A en 2023)
        - Int√©r√™ts exon√©r√©s d‚Äôimp√¥t (pour les livrets r√©glement√©s)
        - Plafond de d√©p√¥t
        - Acc√®s √† l‚Äôargent √† tout moment (liquidit√©)

        *Avantages :*
        - S√©curit√© totale (capital garanti)
        - Aucun risque de perte
        - Simplicit√© d‚Äôutilisation

        *Inconv√©nients :*
        - Rendement faible
        - Rendement souvent inf√©rieur √† l‚Äôinflation
        - Plafond qui limite l‚Äô√©pargne
        """)

    with st.expander("üè¢ Qu'est-ce qu'une SCPI ?", expanded=False):
        st.markdown("""
        *Une SCPI (Soci√©t√© Civile de Placement Immobilier) vous permet d‚Äôinvestir dans l‚Äôimmobilier sans acheter directement un bien.*

        *Caract√©ristiques :*
        - Vous achetez des parts de la SCPI
        - Elle investit dans des immeubles (bureaux, commerces, logements)
        - Les loyers per√ßus sont redistribu√©s aux porteurs de parts

        *Avantages :*
        - Revenus r√©guliers (loyers)
        - Mutualisation du risque
        - Accessibilit√© (ticket d‚Äôentr√©e plus faible qu‚Äôun achat immobilier direct)

        *Inconv√©nients :*
        - Capital non garanti
        - Liquidit√© limit√©e (revente des parts pas toujours imm√©diate)
        - Frais d‚Äôentr√©e parfois √©lev√©s
        """)

    with st.expander("ü™ô Qu'est-ce qu'une cryptomonnaie ?", expanded=False):
        st.markdown("""
        *Une cryptomonnaie est une monnaie num√©rique, d√©centralis√©e, et souvent bas√©e sur la technologie blockchain.*

        *Caract√©ristiques :*
        - Aucune autorit√© centrale (banque ou gouvernement)
        - Transactions anonymes et s√©curis√©es via blockchain
        - Volatilit√© tr√®s √©lev√©e

        *Avantages :*
        - Potentiel de rendement tr√®s √©lev√©
        - Accessibilit√© mondiale
        - Innovation technologique

        *Inconv√©nients :*
        - Risque √©lev√© de perte
        - R√©glementation floue ou absente
        - Pas de revenus passifs (pas de dividende ni coupon)
        """)



    
    # Style du bouton bleu
    st.markdown("""
        <style>
        div.stButton > button {
            background-color: #42a5f5;
            color: white;
            border: none;
            border-radius: 25px;
            padding: 0.8em 1.5em;
            font-size: 18px;
            font-weight: bold;
            transition: 0.3s;
        }
        div.stButton > button:hover {
            background-color: #1e88e5;
            transform: scale(1.05);
        }
        </style>
    """, unsafe_allow_html=True)
    
    # Colonne principale √† gauche + vide √† droite
    col1, col2 = st.columns([1, 3])  # bouton √† gauche
    with col1:
        if st.button("Retourner √† l'accueil"):
            st.session_state.page = "Accueil"
            st.experimental_rerun()









if page == "Testez vos connaissances fianci√®res":
    
    st.header("üß† Testez vos connaissances financi√®res avec FinFlation")
    
    st.markdown("""
    <div style="background-color: #283593; padding: 25px; border-radius: 15px; color: white; margin-bottom: 20px;">
        <p style="font-size: 18px;">
            Ce test est con√ßu pour √©valuer vos <span style="font-weight: 900;">connaissances financi√®res</span> de mani√®re ludique. 
            Il couvre les notions essentielles abord√©es dans les sections <span style="font-weight: 900;">Vocabulaire financier</span> 
            et <span style="font-weight: 900;">Comprendre les placements</span>.
        </p>
        <p style="font-size: 18px;">
            Cliquez sur <span style="font-weight: 900;">"Lancer le test"</span> pour d√©buter. Vous verrez une s√©rie de questions √† choix unique. 
            Une fois termin√©, appuyez sur <span style="font-weight: 900;">"Valider mes r√©ponses"</span> pour afficher la correction, 
            o√π les bonnes r√©ponses auront l'√©moji ‚úÖ et les mauvaises auront l'√©moji ‚ùå avec une correction en dessous. 
        </p>
    </div>
    """, unsafe_allow_html=True)
    
    # Questions de la base
    questions = [
        {
            "question": "Quel est l‚Äôavantage principal d‚Äôun ETF ?",
            "options": [
                "Garantit un rendement fixe",
                "R√©plique la performance d‚Äôun indice",
                "Offre une protection contre la d√©flation",
                "Permet d‚Äô√©viter tout risque de march√©"
            ],
            "answer": 1
        },
        {
            "question": "Qu‚Äôest-ce que la volatilit√© en finance ?",
            "options": [
                "La vitesse d'achat ou de vente d'un actif",
                "La fr√©quence et l‚Äôamplitude des variations de prix",
                "Le rendement garanti d‚Äôun actif",
                "Le taux d‚Äôint√©r√™t appliqu√© aux emprunts"
            ],
            "answer": 1
        },
        {
            "question": "Qu‚Äôest-ce qu‚Äôun indice boursier ?",
            "options": [
                "Une mesure du taux d‚Äôint√©r√™t bancaire",
                "Un groupe d‚Äôentreprises cot√©es repr√©sent√© par un chiffre",
                "Un outil pour fixer le prix d‚Äôune action",
                "Un fonds d‚Äôinvestissement √† haut risque"
            ],
            "answer": 1
        },
        {
            "question": "Qu‚Äôest-ce qu‚Äôune action ?",
            "options": [
                "Une obligation d‚Äô√âtat",
                "Un produit d‚Äô√©pargne garanti",
                "Une part de propri√©t√© dans une entreprise",
                "Un indice boursier"
            ],
            "answer": 2
        },
        {
            "question": "Qu‚Äôest-ce que la liquidit√© d‚Äôun actif ?",
            "options": [
                "Sa rentabilit√© garantie",
                "La facilit√© avec laquelle il peut √™tre achet√© ou vendu",
                "Le risque qu‚Äôil repr√©sente",
                "Son rendement annuel moyen"
            ],
            "answer": 1
        },
        {
            "question": "Quelle est la caract√©ristique principale d‚Äôun Livret A ?",
            "options": [
                "Risque √©lev√©",
                "Rendement sup√©rieur √† l‚Äôinflation",
                "Fonds investis dans des actions",
                "Placement s√©curis√© et liquide"
            ],
            "answer": 3
        },
        {
            "question": "Pourquoi diversifier ses placements ?",
            "options": [
                "Pour maximiser les pertes",
                "Pour r√©duire les risques",
                "Pour augmenter les frais bancaires",
                "Pour investir uniquement dans des actions"
            ],
            "answer": 1
        },
        {
            "question": "Quel placement permet une disponibilit√© imm√©diate des fonds ?",
            "options": [
                "L'immobilier locatif",
                "Le Livret A",
                "Les obligations d'√âtat",
                "Les actions"
            ],
            "answer": 1
        },
        {
            "question": "Que refl√®te un indice boursier comme le CAC 40 ?",
            "options": [
                "La performance moyenne de plusieurs entreprises",
                "La rentabilit√© des obligations",
                "Le taux d‚Äô√©pargne moyen des m√©nages",
                "La valeur de l‚Äôor sur le march√© international"
            ],
            "answer": 0
        },
        {
            "question": "Quel est le principal risque d‚Äôun ETF ?",
            "options": [
                "Aucun, c‚Äôest garanti par l‚Äô√âtat",
                "Il peut √™tre difficile √† vendre",
                "Il peut varier fortement avec le march√©",
                "Il offre peu de diversification"
            ],
            "answer": 2
        },
        {
        "question": "Que repr√©sente la capitalisation boursi√®re d'une entreprise ?",
        "options": [
            "Le montant de ses b√©n√©fices annuels",
            "La valeur totale de ses actifs immobiliers",
            "Le prix d‚Äôune action multipli√© par le nombre d‚Äôactions",
            "Son chiffre d'affaires"
        ],
        "answer": 2
    },
    {
        "question": "Quel est l‚Äôun des principaux avantages d‚Äôun ETF ?",
        "options": [
            "Il est exon√©r√© d'imp√¥ts",
            "Il permet une diversification automatique",
            "Il garantit un rendement fixe",
            "Il est g√©r√© activement au quotidien"
        ],
        "answer": 1
    },
    {
        "question": "Quel terme d√©signe la rapidit√© avec laquelle un actif peut √™tre vendu sans perte significative de valeur ?",
        "options": [
            "Rendement",
            "Inflation",
            "Volatilit√©",
            "Liquidit√©"
        ],
        "answer": 3
    },
    {
        "question": "Pourquoi le Livret A est-il consid√©r√© comme un placement s√©curis√© ?",
        "options": [
            "Il rapporte plus que les actions",
            "Il est garanti par l‚Äô√âtat",
            "Il est index√© sur l‚Äôor",
            "Il est toujours sup√©rieur √† l‚Äôinflation"
        ],
        "answer": 1
    },
    {
        "question": "Qu'est-ce qu‚Äôun fonds d‚Äôinvestissement ?",
        "options": [
            "Un pr√™t entre particuliers",
            "Un panier de plusieurs actifs g√©r√© par des professionnels",
            "Une obligation d‚Äô√âtat",
            "Un compte bancaire √† taux fixe"
        ],
        "answer": 1
    },
    {
        "question": "Quelle affirmation est vraie concernant les actions ?",
        "options": [
            "Elles garantissent un rendement annuel fixe",
            "Elles sont des produits d‚Äô√©pargne r√©glement√©s",
            "Elles repr√©sentent une part de propri√©t√© d‚Äôune entreprise",
            "Elles ne sont accessibles qu‚Äôaux professionnels"
        ],
        "answer": 2
    },
    {
        "question": "√Ä quoi sert un indice boursier comme le CAC 40 ?",
        "options": [
            "√Ä fixer le prix des produits alimentaires",
            "√Ä mesurer la performance moyenne d‚Äôun groupe d‚Äôentreprises",
            "√Ä calculer le taux d‚Äôimposition sur les revenus",
            "√Ä suivre la croissance d√©mographique"
        ],
        "answer": 1
    },
    {
        "question": "Quelle est une caract√©ristique essentielle d‚Äôun ETF ?",
        "options": [
            "Il se n√©gocie uniquement en fin de journ√©e",
            "Il r√©plique un indice de march√©",
            "Il est plafonn√© √† 10 000 ‚Ç¨",
            "Il ne peut pas √™tre vendu avant 5 ans"
        ],
        "answer": 1
    },
    {
        "question": "Comment l‚Äôinflation affecte-t-elle votre √©pargne ?",
        "options": [
            "Elle augmente automatiquement votre capital",
            "Elle r√©duit le pouvoir d‚Äôachat de votre argent",
            "Elle garantit un taux d‚Äôint√©r√™t plus √©lev√©",
            "Elle annule tous les rendements"
        ],
        "answer": 1
    },
    {
        "question": "Quel placement est le plus liquide parmi les suivants ?",
        "options": [
            "L‚Äôachat d‚Äôun appartement",
            "Un Livret A",
            "Un contrat d‚Äôassurance-vie bloqu√©",
            "Un ETF avec un pr√©avis de vente"
        ],
        "answer": 1
    }
    ]

    import random
    if "quiz_started" not in st.session_state:
        st.session_state.quiz_started = False
    if "quiz_data" not in st.session_state:
        st.session_state.quiz_data = []
    if "quiz_answers" not in st.session_state:
        st.session_state.quiz_answers = []
    if "quiz_validated" not in st.session_state:
        st.session_state.quiz_validated = False
    
    if not st.session_state.quiz_started:
        if st.button("üöÄ Lancer le test"):
            st.session_state.quiz_started = True
            st.session_state.quiz_validated = False
            st.session_state.quiz_data = random.sample(questions, k=min(10, len(questions)))
            st.session_state.quiz_answers = [None] * len(st.session_state.quiz_data)
            st.experimental_rerun()
            
    else:
        for i, q in enumerate(st.session_state.quiz_data):
            st.markdown(f"**{i+1}. {q['question']}**")
        
            selected = st.radio(
                label="", 
                options=q["options"], 
                key=f"q_{i}"
            )
        
            # Si une s√©lection est faite, on l'enregistre
            if selected is not None:
                st.session_state.quiz_answers[i] = q["options"].index(selected)


        if not st.session_state.quiz_validated:
            if st.button("‚úÖ Valider mes r√©ponses"):
                st.session_state.quiz_validated = True
                st.experimental_rerun()
        else:
            st.markdown("""
            <hr style="height: 3px; background-color: #4CAF50; border: none; margin-top: 30px; margin-bottom: 30px;">
            """, unsafe_allow_html=True)
            st.markdown("""
            <h2 style='color: #4CAF50; margin-top: 40px;'>üìã Correction de votre test</h2>
            """, unsafe_allow_html=True)
            score = 0
            for i, q in enumerate(st.session_state.quiz_data):
                user_answer = st.session_state.quiz_answers[i]
                correct_answer = q["answer"]
                st.markdown(f"**{i+1}. {q['question']}**")
                if user_answer == correct_answer:
                    st.markdown(f"<span style='color: limegreen; font-weight: bold;'>‚úÖ {q['options'][user_answer]}</span>", unsafe_allow_html=True)
                    score += 1
                else:
                    st.markdown(f"<span style='color: red;'>‚ùå {q['options'][user_answer]}</span>", unsafe_allow_html=True)
                    st.markdown(f"<span style='color: limegreen;'>‚úî Bonne r√©ponse : {q['options'][correct_answer]}</span>", unsafe_allow_html=True)
            st.markdown(f"""
            <div style="margin-top: 20px; padding: 10px; background-color: #0d47a1; color: white; border-radius: 10px;">
                <strong>Score final :</strong> {score} / {len(st.session_state.quiz_data)}
            </div>
            """, unsafe_allow_html=True)
            st.markdown("""
            <hr style="height: 3px; background-color: #4CAF50; border: none; margin-top: 30px; margin-bottom: 30px;">
            """, unsafe_allow_html=True)
            if st.button("‚ùå Fermer le QCM"):
                st.session_state.quiz_started = False
                st.experimental_rerun()

    
    
    # Style du bouton bleu
    st.markdown("""
        <style>
        div.stButton > button {
            background-color: #42a5f5;
            color: white;
            border: none;
            border-radius: 25px;
            padding: 0.8em 1.5em;
            font-size: 18px;
            font-weight: bold;
            transition: 0.3s;
        }
        div.stButton > button:hover {
            background-color: #1e88e5;
            transform: scale(1.05);
        }
        </style>
    """, unsafe_allow_html=True)
    
    # Affiche le bouton retour uniquement si le test n'est PAS lanc√©
    if not st.session_state.quiz_started:
        col1, col2 = st.columns([1, 3])  # bouton √† gauche
        with col1:
            if st.button("Retourner √† l'accueil"):
                st.session_state.page = "Accueil"
                st.experimental_rerun()

    
    
    
    
    
    
    
if page == "Simulateur d'investissement":
    
    st.header("üìä Simulateur d'investissement intelligent")
    
    # Ajout du disclaimer
    st.markdown("""
    <div class="disclaimer-box">
        ‚ö† <strong>Disclaimer :</strong> Cette simulation est fournie √† titre informatif uniquement et ne constitue pas 
        un conseil en investissement. Les r√©sultats sont bas√©s sur des hypoth√®ses et des donn√©es historiques qui ne 
        garantissent pas les performances futures. Consultez un conseiller financier avant toute d√©cision d'investissement.
    </div>
    """, unsafe_allow_html=True)
    
    with st.expander("‚öô Param√®tres de simulation", expanded=True):
        col1, col2, col3 = st.columns(3)
        with col1:
            etf_ticker = st.selectbox(
                "FINANCIAGE",
                ("SPY", "QQQ", "VTI", "VT", "ARKK"),
                index=0
            )
        with col2:
            years = st.slider(
                "Nombre d'ann√©es d'investissement",
                min_value=1, max_value=30, value=10, step=1
            )
        with col3:
            investment_amount = st.number_input(
                "Montant √† investir (en USD)",
                min_value=100, max_value=1000000, value=10000, step=1000
            )
    
    if st.button("Lancer la simulation"):
        with st.spinner('Calcul en cours...'):
            # Fonctions de calcul
            def get_etf_data(ticker):
                etf = yf.Ticker(ticker)
                hist = etf.history(period="5y")
                hist['Daily Return'] = hist['Close'].pct_change()
                mean_return = hist['Daily Return'].mean()
                daily_vol = hist['Daily Return'].std()
                return hist['Close'].iloc[-1], mean_return, daily_vol

            def get_inflation_rate():
                inflation_ticker = "^IRX"
                inflation_data = yf.Ticker(inflation_ticker)
                hist = inflation_data.history(period="1mo")
                if not hist.empty:
                    return hist['Close'].iloc[-1] / 100
                return None

            def monte_carlo_simulation(current_price, mean_daily_return, daily_vol, years, simulations=1000):
                days = years * 252
                np.random.seed(42)
                daily_returns = np.random.normal(loc=mean_daily_return, scale=daily_vol, size=(days, simulations))
                price_paths = current_price * np.exp(np.cumsum(daily_returns, axis=0))
                return price_paths

            beta = 0.5
            current_price, mean_daily_return, daily_vol = get_etf_data(etf_ticker)
            inflation_rate = get_inflation_rate()
            livret_a_rate = 0.024

            if inflation_rate is not None:
                # Simulation Monte Carlo
                prices = monte_carlo_simulation(current_price, mean_daily_return, daily_vol, years)
                final_prices = prices[-1]
                mean_final_price = np.mean(final_prices)
                total_return = (mean_final_price - current_price) / current_price
                simulated_annual_return = (1 + total_return) ** (1 / years) - 1

                historical_annual_return = (1 + mean_daily_return) ** 252 - 1
                annualized_etf_return = beta * historical_annual_return + (1 - beta) * simulated_annual_return

                proportion_etf = 0
                proportion_livret = 100
                target_value_livret_a = investment_amount * (1 + livret_a_rate)**years

                while True:
                    etf_investment = investment_amount * proportion_etf / 100
                    livret_a_investment = investment_amount * proportion_livret / 100

                    vf_etf = etf_investment * ((1 + annualized_etf_return) / (1 + inflation_rate)) ** years
                    vf_livret = livret_a_investment * ((1 + livret_a_rate) / (1 + inflation_rate)) ** years
                    total_value = vf_etf + vf_livret

                    if total_value >= target_value_livret_a:
                        break

                    proportion_etf += 0.5
                    proportion_livret -= 0.5

                # Affichage des r√©sultats
                st.success("Simulation termin√©e avec succ√®s!")
                
                # M√©triques
                col1, col2, col3 = st.columns(3)
                with col1:
                    st.metric("Rendement ETF annualis√©", f"{annualized_etf_return:.2%}")
                with col2:
                    st.metric("Taux d'inflation", f"{inflation_rate:.2%}")
                with col3:
                    st.metric("Taux Livret A", f"{livret_a_rate:.2%}")
                
                # Graphique de r√©partition avec titre blanc
                fig1 = go.Figure(go.Pie(
                    labels=['ETF', 'Livret A'],
                    values=[proportion_etf, proportion_livret],
                    hole=.4,
                    marker_colors=['#4CAF50', '#2196F3']
                ))
                fig1.update_layout(
                    title_text="R√©partition optimale de votre portefeuille",
                    title_font_color="white",
                    title_x=0.5,
                    paper_bgcolor='rgba(0,0,0,0)',
                    plot_bgcolor='rgba(0,0,0,0)',
                    font=dict(color='white')
                )
                st.plotly_chart(fig1, use_container_width=True)
                
                
                
                
    
            
# Pied de page
st.markdown("---")
st.markdown("""
<div style="text-align: center; padding: 20px;">
    <p>FinFlation - Outil de simulation d'investissement intelligent</p>
    <p>¬© 2025 Tous droits r√©serv√©s</p>
</div>
""", unsafe_allow_html=True)



